Steps:

1. create a RDS instance 

Standard Create

create a rds instance of MySQl type

Templates - Free Tier

Credentials (keep the same user name and password):
user - admin
password - password

storage capacity - 20 GB

Disable auto storage scaling

Connectivity - Dont Connect to EC2

Network type - IPv4

VPC - default VPC

public access - Yes

create a new security group (dont use an existing one)

Availiability zone - us-east-1a

Database authentication 
Password authentication

Monitoring

Diable - Enhanced monitoring

Additional Configuration 

Disble automated backup

create the database


3. create a normal ec2 instance; open ports http and ssh in security group


4. on the ec2 instance, run the following commands:

connect to the EC2 instance using the AWS Connect option via instance connect or via ssh 

a. sudo su 

b. wget https://gaurav-public-bucket.s3.amazonaws.com/project-data/springboot-backend.jar

c. sudo yum -y install java-1.8.0

wget https://dev.mysql.com/get/mysql80-community-release-el9-1.noarch.rpm
dnf install -y mysql-community-server


d. create a file with the following details 

// create the application.properties with the following content:
vi application.properties

press i key

(paste the below lines in the application properties file)

# temp file
server.port=80
spring.datasource.url=jdbc:mysql://<specify your database endpoint>:3306/test?createDatabaseIfNotExist=true
spring.datasource.username=admin
spring.datasource.password=password
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5InnoDBDialect
hibernate.dialect.storage_engine=innodb
spring.jpa.database-platform: org.hibernate.dialect.MySQL5InnoDBDialect
spring.jpa.hibernate.ddl-auto=update

--- copy content end --- dont copy this line

press esc key
press :wq


e. run the java application using the following commands

java -jar springboot-backend.jar 

the application by default will run on port 80

If there is no error while running the application, then

f. stop the application by pressing Ctrl c

g. run the below command (this will prevent the application to stop if the ssh session is terminated)

nohup java -jar springboot-backend.jar & 

Verify that the application is configured correctly by using the following url:

http://<ec-ip-address>/api/v1/employees

You should see [] as the response in the browser tab

5a. create a load balancer and register the ec2 instance with the load balancer. 
Allow mapping for all AZs. 
In SG, allow all ports
while registering the ec2 instance use port 80
the ec2 intance should come to healthy state

5b. Verify that the load balcner is working correctly by using the following from your browser tab:

http://<alb dna name>/api/v1/employees

You should see [] as the response in the browser tab

6. once we have the load balancer address, then we need to add the same in the frontend UI files

main (in windows, the file name that you will see is only main, so modify that file)

search for /api/v1/employees and replace the load balancer with the new load balancer.


7. create a new s3 bucket and make the following changes:

a. make the bucket public by the policy, change the bucket name

{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::<bucket-name>/*"
        }
    ]
}

b. Block public access (bucket settings) - set it to OFF

c. download the following file - https://gaurav-public-bucket.s3.amazonaws.com/project-data/angular-frontend.zip 
unzip the same and modify the main.js file and replace the load balancer to your load balancer 
search for api/v1 and then repalce alb

d. enable the Static site hosting option  - set the index to index.html file 



###### The below steps are not required

Below steps not required. 

3.1 - once the EC2 is created, then go to Actions -> Networking -> Connect to RDS and connect to the RDS instance. This will establish the required connectivity between EC2 and RDS.

mysql -u admin -h <db endpoint name>  -p
password: password

SHOW DATABASES;

// the below settings are not required.
c. in bucket permission, edit Cross-origin resource sharing (CORS) and add the following statements

[
    {
        "AllowedHeaders": [],
        "AllowedMethods": [
            "GET",
            "HEAD",
            "POST",
            "DELETE"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": []
    }



2. using DB weaver, connect to RDS and create a new database using the following sql command

Hostname - endpoint name
database - mysql
username - admin
password - password

create a database with name "test" using the DBeaver UI

SPRING_DATASOURCE_URL=jdbc:mysql://${RDS_HOSTNAME}:3306/test?createDatabaseIfNotExist=true
SERVER_PORT=5000

SPRING_DATASOURCE_URL=jdbc:mysql://awseb-e-jkbcvxuhpi-stack-awsebrdsdatabase-6tnsb85yxcuc.cyvai2w24sic.us-east-1.rds.amazonaws.com:3306/test?createDatabaseIfNotExist=true
